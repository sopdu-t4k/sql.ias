# Информационно-аналитическая система
_Проектирование базы данных_

Данная база предназначена для хранения отчетов подведомственных организаций за каждый квартал каждого года. Представитель от каждой оганизации раз в квартал заполяет форму отчета на сайте и отправляет ее на согласование администратору. Администратор может отклонить форму, если отчет прислали с ошибками, или принять ее, если отчет составлен верно. Имея данные по всем организациям за отчетный период, администратор может получать данные для аналитики деятельности подведомственных организаций. Аналитика производится по показателям, каждый показатель расчитывается из присланных данных, которые соотнесены с этим показателем.

### Организации и пользователи

Таблица `org_group` является справочником для групп и подгрупп организаций. Столбец `parent_org_group` может содержать id группы из этой же таблицы, подгруппой которой является данная запись.

Таблица `organizations` содержит список подведомственных организаций. Столбец `org_group_id` должен содержать id подгруппы организаций из таблицы `org_group`. Столбец `is_active` служит для хранения булева значения, чтобы не удалять записи об организациях, а просто помечать их как не активные.

Таблица `users` содержит список пользователей системы. `login` является уникальным, по нему добавлена индексация таблицы. Столбец `org_id` должен содержать id организации из таблицы `organizations`, которой принадлежит данный пользователь. Столбец `is_admin` служит для хранения булева значения, отмечая, имеет ли пользователь роль администратора системы. Столбец `is_active` содержит булево значение, которое означает действующий ли это пользователь или не активный.

### Структура формы отчета

Таблица `parameters` содержит список показателей, по которым производится аналитика деятельности организации. `name` -  наименование показателя, `unit` - единица измерения, в которой будет расчитан показатель, `sequence` - порядковый номер показателя. `is_active` содержит булево значение, которое означает включен данный показатель в аналитику или нет.

Таблица `fields` содержит список полей формы отчета, которые нужны для расчета показателей. `name` -  наименование поля, `type` - выбор из списка типов поля (число, дата, чекбокс, текст), `unit` - единица измерения. Столбцы `min_val` и `max_val` содержат минимальное и максимальное значение, которое можно указать в поле, эти данные нужны для автоматической проверки при заполнении отчетов пользователями. Столбец `is_active` содержит булево значение, которое означает активно ли поле.

Таблица `structure` отображает структуру формы отчета по показателям. Одно поле может использоваться для расчета разных показателей, поэтому в данной таблице соотносятся показатели и поля формы. `param_id` показывает какому показателю из таблицы `parameters` соответствует `field_id` - поле из таблицы `fields`. Сочетание `param_id` и `field_id` является уникальным.

### Данные отчетов

Таблица `statuses` является справочником для статусов, которые могут быть присвоены отчетам.

Таблица `forms` хранит все формы отчетов, которые были сохранены в системе. Столбец `org_id` содержит id организации из таблицы `organizations`, по которой сформирован отчет. Столбец `status_id` содержит id текущего статуса отчета из таблицы `statuses`. Столбцы `quarter` и `year` содержат информацию за какой квартал какого года сформирован отчет. Сочетание `org_id`, `quarter` и `year` является уникальным, т.к. у одной организации может быть только один отчет за квартал. Добавлена индексация таблицы по `org_id` для поиска отчетов по id организации. `created_at` хранит дату и время создания отчета.

Таблица `fields_values` хранит данные всех заполненных полей форм отчетов. Столбец `form_id` содержит id формы отчета из таблицы `forms`, столбец `field_id` содержит id поля из таблицы `fields`, сочетание этих значений является уникальным. Столбец `value` содержит значения полей, тип поля может быть разный, поэтому данные хранятся как строчные. Правильность заполнения поля контролируется бизнес-логикой приложения.

Таблица `status_history` хранит историю изменения статусов отчетов. Столбец `form_id` содержит id формы отчета из таблицы `forms`, столбец `status_id` содержит id статуса отчета из таблицы `statuses`. Столбец `user_id` содержит id пользователя из таблицы `users`, который изменил статус отчета. `created_at` хранит дату и время изменения статуса.